<!DOCTYPE html>
<html lang="en">
<head>
    <!-- IMPORTANT: Make sure your text editor saves this file with UTF-8 Encoding! -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Concepts of Critical Thinking Quiz</title> <!-- Changed Title -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="password"] { width: 100%; padding: 8px; box-sizing: border-box; }
        input[type="radio"] { margin-right: 5px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #error-message, #password-error, #login-error { color: red; font-size: 1.2em; text-align: center; }
        #success-message { color: green; font-size: 1.2em; text-align: center; }
        #results, #review-section, #submission-copy { margin-top: 20px; text-align: left; border: 1px solid #ccc; padding: 15px; border-radius: 5px; background-color: #f9f9f9;}
        #password-section, #login-section { text-align: center; max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;}
        #password-section input[type="password"], #login-section input[type="text"], #login-section input[type="password"] { width: calc(100% - 18px); }
        .question-result { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        #download-pdf, #download-response { margin-top: 10px; }
        #score { font-weight: bold; text-align: center; color: green; font-size: 1.4em; margin-top: 20px; }
        #review-section h2, #submission-copy h2, #results h1 { margin-bottom: 15px; text-align: center; color: #007bff;}
        #review-section button, #submission-copy button, #password-section button, #login-section button, #results button { margin-top: 15px; }
        .choices p { margin: 2px 0 2px 20px; }
    </style>
</head>
<body>
    <div id="login-section">
        <h1>Login to Access Quiz</h1>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" placeholder="Enter password" required>
        </div>
        <button onclick="checkLogin()">Login</button>
        <p id="login-error" class="hidden">Incorrect username or password. Please try again.</p>
    </div>

    <div id="quiz-form" class="hidden">
        <h1>Basic Concepts of Critical Thinking Quiz - Chapter 4</h1> <!-- Changed Title -->
        <form id="mcie-quiz"> <!-- ID Kept, content changed -->
            <!-- Student Information -->
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="id_number">ID Number:</label>
                <input type="text" id="id_number" name="id_number" required>
            </div>
            <div class="form-group">
                <label for="section">Section:</label>
                <input type="text" id="section" name="section" required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <!-- Basic Concepts of Critical Thinking Multiple-Choice Questions -->
            <div class="form-group">
                 <label>1. The main goal of teaching critical thinking is to teach students:</label>
                 <input type="radio" name="q1" value="A" required> A) To passively absorb information for tests.<br>
                 <input type="radio" name="q1" value="B"> B) How to become independent, self-directed thinkers and learners.<br>
                 <input type="radio" name="q1" value="C"> C) Specific facts about various academic subjects.<br>
                 <input type="radio" name="q1" value="D"> D) To agree with the majority opinion.
            </div>
            <div class="form-group">
                 <label>2. Critical thinking, in a precise sense, involves cognitive skills and dispositions needed to:</label>
                 <input type="radio" name="q2" value="A" required> A) Memorize and repeat information.<br>
                 <input type="radio" name="q2" value="B"> B) Accept claims based on authority without question.<br>
                 <input type="radio" name="q2" value="C"> C) Effectively identify, analyze, and evaluate arguments and truth claims.<br>
                 <input type="radio" name="q2" value="D"> D) Focus only on the emotional aspects of issues.
            </div>
            <div class="form-group">
                 <label>3. John Dewey defined critical thinking as an "active" process, meaning it involves:</label>
                 <input type="radio" name="q3" value="A" required> A) Receiving ideas passively from others.<br>
                 <input type="radio" name="q3" value="B"> B) Thinking things through for oneself, raising questions, and finding information.<br>
                 <input type="radio" name="q3" value="C"> C) Jumping to conclusions quickly.<br>
                 <input type="radio" name="q3" value="D"> D) Relying solely on intuition.
            </div>
            <div class="form-group">
                 <label>4. According to Dewey, the "grounds" which support a belief refer to:</label>
                 <input type="radio" name="q4" value="A" required> A) The emotional appeal of the belief.<br>
                 <input type="radio" name="q4" value="B"> B) The popularity of the belief.<br>
                 <input type="radio" name="q4" value="C"> C) The reasons one has for holding the belief.<br>
                 <input type="radio" name="q4" value="D"> D) The further conclusions that follow from the belief.
            </div>
            <div class="form-group">
                 <label>5. Edward Glaser's definition of critical thinking includes an attitude, knowledge of logical methods, and:</label>
                 <input type="radio" name="q5" value="A" required> A) A high intelligence quotient.<br>
                 <input type="radio" name="q5" value="B"> B) Extensive factual knowledge.<br>
                 <input type="radio" name="q5" value="C"> C) Skill in applying logical methods.<br>
                 <input type="radio" name="q5" value="D"> D) The ability to persuade others.
            </div>
            <div class="form-group">
                 <label>6. Robert Ennis defined critical thinking as "reasonable, reflective thinking focused on":</label>
                 <input type="radio" name="q6" value="A" required> A) Winning arguments.<br>
                 <input type="radio" name="q6" value="B"> B) Understanding historical context.<br>
                 <input type="radio" name="q6" value="C"> C) Achieving personal success.<br>
                 <input type="radio" name="q6" value="D"> D) Deciding what to believe or do.
            </div>
            <div class="form-group">
                 <label>7. Richard Paul's definition emphasizes improving thinking by skillfully taking charge of its inherent structures and:</label>
                 <input type="radio" name="q7" value="A" required> A) Applying emotional intelligence.<br>
                 <input type="radio" name="q7" value="B"> B) Consulting with experts.<br>
                 <input type="radio" name="q7" value="C"> C) Imposing intellectual standards upon them.<br>
                 <input type="radio" name="q7" value="D"> D) Remembering past experiences.
            </div>
            <div class="form-group">
                 <label>8. Michael Scriven defined critical thinking as the "skilled and active interpretation and evaluation" of observations, communications, information, and:</label>
                 <input type="radio" name="q8" value="A" required> A) Personal feelings.<br>
                 <input type="radio" name="q8" value="B"> B) Argumentation.<br>
                 <input type="radio" name="q8" value="C"> C) Historical trends.<br>
                 <input type="radio" name="q8" value="D"> D) Artistic expressions.
            </div>
            <div class="form-group">
                 <label>9. The term "criticocreative" thinking is used to highlight that effective evaluation often requires:</label>
                 <input type="radio" name="q9" value="A" required> A) Sticking strictly to established procedures.<br>
                 <input type="radio" name="q9" value="B"> B) Ignoring alternative possibilities.<br>
                 <input type="radio" name="q9" value="C"> C) Imagination and creativity regarding alternatives and possibilities.<br>
                 <input type="radio" name="q9" value="D"> D) Focusing only on the negative aspects of an argument.
            </div>
            <div class="form-group">
                 <label>10. Which of the following is listed as a key intellectual standard for critical thinking?</label>
                 <input type="radio" name="q10" value="A" required> A) Popularity<br>
                 <input type="radio" name="q10" value="B"> B) Emotional Intensity<br>
                 <input type="radio" name="q10" value="C"> C) Clarity<br>
                 <input type="radio" name="q10" value="D"> D) Subjectivity
            </div>
            <div class="form-group">
                 <label>11. The standard of "Clarity" requires that concepts and language be:</label>
                 <input type="radio" name="q11" value="A" required> A) Highly complex and technical.<br>
                 <input type="radio" name="q11" value="B"> B) Free of obscurity and vagueness.<br>
                 <input type="radio" name="q11" value="C"> C) Emotionally charged.<br>
                 <input type="radio" name="q11" value="D"> D) Open to multiple interpretations.
            </div>
            <div class="form-group">
                 <label>12. Why is clarity considered a "gateway standard"?</label>
                 <input type="radio" name="q12" value="A" required> A) It is the least important standard.<br>
                 <input type="radio" name="q12" value="B"> B) It only applies to written arguments.<br>
                 <input type="radio" name="q12" value="C"> C) If a statement is unclear, its accuracy or relevance cannot be determined.<br>
                 <input type="radio" name="q12" value="D"> D) Clear statements are always true.
            </div>
            <div class="form-group">
                 <label>13. The standard of "Precision" involves being:</label>
                 <input type="radio" name="q13" value="A" required> A) Vague and general.<br>
                 <input type="radio" name="q13" value="B"> B) Subjective and opinionated.<br>
                 <input type="radio" name="q13" value="C"> C) Exact, accurate, and careful.<br>
                 <input type="radio" name="q13" value="D"> D) Brief and concise.
            </div>
            <div class="form-group">
                 <label>14. The standard of "Accuracy" relates to:</label>
                 <input type="radio" name="q14" value="A" required> A) Using grammatically correct language.<br>
                 <input type="radio" name="q14" value="B"> B) Ensuring information is correct and true.<br>
                 <input type="radio" name="q14" value="C"> C) Expressing ideas eloquently.<br>
                 <input type="radio" name="q14" value="D"> D) Citing numerous sources.
            </div>
            <div class="form-group">
                 <label>15. The standard of "Relevance" means that ideas and information should:</label>
                 <input type="radio" name="q15" value="A" required> A) Be connected and bear upon the issue at hand.<br>
                 <input type="radio" name="q15" value="B"> B) Come from a recognized authority.<br>
                 <input type="radio" name="q15" value="C"> C) Be completely new and original.<br>
                 <input type="radio" name="q15" value="D"> D) Be complex and difficult to understand.
            </div>
            <div class="form-group">
                 <label>16. "Logical inconsistency" refers to:</label>
                 <input type="radio" name="q16" value="A" required> A) Saying one thing and doing another.<br>
                 <input type="radio" name="q16" value="B"> B) Holding beliefs that cannot all be true simultaneously.<br>
                 <input type="radio" name="q16" value="C"> C) Disagreeing with an authority figure.<br>
                 <input type="radio" name="q16" value="D"> D) Changing one's mind based on new evidence.
            </div>
            <div class="form-group">
                 <label>17. "Practical inconsistency" refers to:</label>
                 <input type="radio" name="q17" value="A" required> A) Believing contradictory statements.<br>
                 <input type="radio" name="q17" value="B"> B) Drawing illogical conclusions.<br>
                 <input type="radio" name="q17" value="C"> C) Saying one thing and doing another (hypocrisy).<br>
                 <input type="radio" name="q17" value="D"> D) Failing to provide evidence for a claim.
            </div>
            <div class="form-group">
                 <label>18. The standard of "Logical Correctness" relates to:</label>
                 <input type="radio" name="q18" value="A" required> A) The truthfulness of the premises.<br>
                 <input type="radio" name="q18" value="B"> B) Reasoning correctly and drawing well-founded conclusions.<br>
                 <input type="radio" name="q18" value="C"> C) Expressing ideas clearly.<br>
                 <input type="radio" name="q18" value="D"> D) Considering all possible viewpoints.
            </div>
            <div class="form-group">
                 <label>19. The standard of "Completeness" suggests a preference for thinking that is:</label>
                 <input type="radio" name="q19" value="A" required> A) Shallow and superficial.<br>
                 <input type="radio" name="q19" value="B"> B) Quick and intuitive.<br>
                 <input type="radio" name="q19" value="C"> C) Deep and thorough.<br>
                 <input type="radio" name="q19" value="D"> D) Focused on a single perspective.
            </div>
            <div class="form-group">
                 <label>20. The standard of "Fairness" requires thinking to be:</label>
                 <input type="radio" name="q20" value="A" required> A) Biased towards one's own viewpoint.<br>
                 <input type="radio" name="q20" value="B"> B) Open-minded, impartial, and free of distorting biases.<br>
                 <input type="radio" name="q20" value="C"> C) Based on popular opinion.<br>
                 <input type="radio" name="q20" value="D"> D) Consistent with tradition.
            </div>
            <div class="form-group">
                 <label>21. The "Structural Principle" of good argument requires that an argument:</label>
                 <input type="radio" name="q21" value="A" required> A) Uses emotionally charged language.<br>
                 <input type="radio" name="q21" value="B"> B) Meets the requirements of being well-formed (e.g., avoids contradictions, assumes conclusion).<br>
                 <input type="radio" name="q21" value="C"> C) Agrees with the arguer's personal beliefs.<br>
                 <input type="radio" name="q21" value="D"> D) Has at least five premises.
            </div>
            <div class="form-group">
                 <label>22. The "Relevance Principle" of good argument requires that premises:</label>
                 <input type="radio" name="q22" value="A" required> A) Are acceptable to the audience.<br>
                 <input type="radio" name="q22" value="B"> B) Provide some evidence for the truth of the conclusion.<br>
                 <input type="radio" name="q22" value="C"> C) Are absolutely true.<br>
                 <input type="radio" name="q22" value="D"> D) Are sufficient to prove the conclusion.
            </div>
            <div class="form-group">
                 <label>23. The "Acceptability Principle" suggests premises should be acceptable to:</label>
                 <input type="radio" name="q23" value="A" required> A) The arguer only.<br>
                 <input type="radio" name="q23" value="B"> B) Anyone, regardless of evidence.<br>
                 <input type="radio" name="q23" value="C"> C) A mature, rational person based on available evidence.<br>
                 <input type="radio" name="q23" value="D"> D) Those who already agree with the conclusion.
            </div>
            <div class="form-group">
                 <label>24. The "Sufficiency Principle" requires that the premises provided are:</label>
                 <input type="radio" name="q24" value="A" required> A) Relevant, acceptable, and adequate in number and weight to justify the conclusion.<br>
                 <input type="radio" name="q24" value="B"> B) Absolutely true.<br>
                 <input type="radio" name="q24" value="C"> C) Emotionally compelling.<br>
                 <input type="radio" name="q24" value="D"> D) Logically valid, regardless of truth.
            </div>
            <div class="form-group">
                 <label>25. The "Rebuttal Principle" requires that a good argument should also:</label>
                 <input type="radio" name="q25" value="A" required> A) Ignore potential criticisms.<br>
                 <input type="radio" name="q25" value="B"> B) Only present evidence supporting its own conclusion.<br>
                 <input type="radio" name="q25" value="C"> C) Anticipate and effectively address serious criticisms against it or the position it supports.<br>
                 <input type="radio" name="q25" value="D"> D) Attack the person making counterarguments.
            </div>
            <div class="form-group">
                 <label>26. The "Fallibility Principle" of critical thinking requires acknowledging that:</label>
                 <input type="radio" name="q26" value="A" required> A) Others are usually wrong.<br>
                 <input type="radio" name="q26" value="B"> B) One's own initial view may be wrong or not the most defensible.<br>
                 <input type="radio" name="q26" value="C"> C) Truth is impossible to find.<br>
                 <input type="radio" name="q26" value="D"> D) Arguments should not be changed once stated.
            </div>
            <div class="form-group">
                 <label>27. The "Truth Seeking Principle" commits participants to:</label>
                 <input type="radio" name="q27" value="A" required> A) Defending their initial position at all costs.<br>
                 <input type="radio" name="q27" value="B"> B) Earnestly searching for the truth or most defensible position.<br>
                 <input type="radio" name="q27" value="C"> C) Finding flaws in opponents' arguments only.<br>
                 <input type="radio" name="q27" value="D"> D) Reaching a quick consensus.
            </div>
            <div class="form-group">
                 <label>28. The "Clarity Principle" in critical discussion requires that formulations be:</label>
                 <input type="radio" name="q28" value="A" required> A) Vague enough to allow flexibility.<br>
                 <input type="radio" name="q28" value="B"> B) Expressed using technical jargon only.<br>
                 <input type="radio" name="q28" value="C"> C) Free of linguistic confusion and clearly separated from other issues.<br>
                 <input type="radio" name="q28" value="D"> D) Brief, even if incomplete.
            </div>
            <div class="form-group">
                 <label>29. The "Burden of Proof Principle" generally rests the obligation to provide reasons on:</label>
                 <input type="radio" name="q29" value="A" required> A) The participant who challenges a claim.<br>
                 <input type="radio" name="q29" value="B"> B) The participant who sets forth the position or makes the claim.<br>
                 <input type="radio" name="q29" value="C"> C) An external authority.<br>
                 <input type="radio" name="q29" value="D"> D) No one; claims don't require proof.
            </div>
            <div class="form-group">
                 <label>30. The "Principle of Charity" requires that when reformulating an opponent's argument, one should:</label>
                 <input type="radio" name="q30" value="A" required> A) Express it in its weakest possible version.<br>
                 <input type="radio" name="q30" value="B"> B) Ignore the original intention of the arguer.<br>
                 <input type="radio" name="q30" value="C"> C) Carefully express it in its strongest possible version consistent with the arguer's intent.<br>
                 <input type="radio" name="q30" value="D"> D) Focus only on the flaws.
            </div>
            <div class="form-group">
                 <label>31. The "Suspension of Judgment Principle" suggests that if no position is well-defended or multiple positions have equal support, one should:</label>
                 <input type="radio" name="q31" value="A" required> A) Choose the position held by the majority.<br>
                 <input type="radio" name="q31" value="B"> B) Choose the position one initially favored.<br>
                 <input type="radio" name="q31" value="C"> C) Suspend judgment about the issue (unless practical needs demand a decision).<br>
                 <input type="radio" name="q31" value="D"> D) Assume the simplest position is true.
            </div>
            <div class="form-group">
                 <label>32. The "Resolution Principle" states an issue should be considered resolved when:</label>
                 <input type="radio" name="q32" value="A" required> A) Everyone agrees, regardless of the arguments.<br>
                 <input type="radio" name="q32" value="B"> B) An argument for one position meets all the principles of a good argument (sound, relevant, sufficient, rebuts criticisms) more successfully than alternatives.<br>
                 <input type="radio" name="q32" value="C"> C) A specific amount of time has passed.<br>
                 <input type="radio" name="q32" value="D"> D) An authority figure declares it resolved.
            </div>
            <div class="form-group">
                 <label>33. A key characteristic of critical thinkers is that they:</label>
                 <input type="radio" name="q33" value="A" required> A) Pretend to know more than they do.<br>
                 <input type="radio" name="q33" value="B"> B) Base judgments on evidence rather than personal preference.<br>
                 <input type="radio" name="q33" value="C"> C) Are impatient with complexity.<br>
                 <input type="radio" name="q33" value="D"> D) Ignore other people's ideas.
            </div>
            <div class="form-group">
                 <label>34. A key characteristic of uncritical thinkers is that they:</label>
                 <input type="radio" name="q34" value="A" required> A) Strive for understanding and keep curiosity alive.<br>
                 <input type="radio" name="q34" value="B"> B) Base judgments on first impressions and gut reactions.<br>
                 <input type="radio" name="q34" value="C"> C) Remain patient with complexity.<br>
                 <input type="radio" name="q34" value="D"> D) Are willing to revise judgments based on new evidence.
            </div>
            <div class="form-group">
                 <label>35. Critical thinkers tend to view problems and controversial issues as:</label>
                 <input type="radio" name="q35" value="A" required> A) Nuisances or threats to their ego.<br>
                 <input type="radio" name="q35" value="B"> B) Exciting challenges.<br>
                 <input type="radio" name="q35" value="C"> C) Reasons to avoid discussion.<br>
                 <input type="radio" name="q35" value="D"> D) Proof that truth is unattainable.
            </div>
            <div class="form-group">
                 <label>36. Compared to uncritical thinkers, critical thinkers are more likely to be:</label>
                 <input type="radio" name="q36" value="A" required> A) Closed-minded and resistant to criticism.<br>
                 <input type="radio" name="q36" value="B"> B) Aware of their own biases and preconceptions.<br>
                 <input type="radio" name="q36" value="C"> C) Indifferent to truth.<br>
                 <input type="radio" name="q36" value="D"> D) Preoccupied with their own opinions.
            </div>
            <div class="form-group">
                 <label>37. Egocentrism, as a barrier to critical thinking, is the tendency to:</label>
                 <input type="radio" name="q37" value="A" required> A) See reality as centered on oneself.<br>
                 <input type="radio" name="q37" value="B"> B) Follow group standards unthinkingly.<br>
                 <input type="radio" name="q37" value="C"> C) Take assumptions for granted without good reason.<br>
                 <input type="radio" name="q37" value="D"> D) Believe something simply because one wishes it were true.
            </div>
            <div class="form-group">
                 <label>38. Self-interested thinking is a form of egocentrism where reasoning is biased by:</label>
                 <input type="radio" name="q38" value="A" required> A) What benefits oneself.<br>
                 <input type="radio" name="q38" value="B"> B) Concern for the group's welfare.<br>
                 <input type="radio" name="q38" value="C"> C) Objective evidence.<br>
                 <input type="radio" name="q38" value="D"> D) Widely accepted facts.
            </div>
            <div class="form-group">
                 <label>39. Sociocentrism is a barrier involving:</label>
                 <input type="radio" name="q39" value="A" required> A) Excessive focus on the self.<br>
                 <input type="radio" name="q39" value="B"> B) Group-centered thinking.<br>
                 <input type="radio" name="q39" value="C"> C) Believing what one wants to believe.<br>
                 <input type="radio" name="q39" value="D"> D) Making assumptions without evidence.
            </div>
            <div class="form-group">
                 <label>40. Group bias, a form of sociocentrism, is the tendency to see one's own group (nation, culture, etc.) as:</label>
                 <input type="radio" name="q40" value="A" required> A) Inferior to others.<br>
                 <input type="radio" name="q40" value="B"> B) Objectively flawed.<br>
                 <input type="radio" name="q40" value="C"> C) Inherently better than others.<br>
                 <input type="radio" name="q40" value="D"> D) Exactly the same as all other groups.
            </div>
            <div class="form-group">
                 <label>41. Conformism refers to the tendency to:</label>
                 <input type="radio" name="q41" value="A" required> A) Think independently.<br>
                 <input type="radio" name="q41" value="B"> B) Follow the crowd or group standards, often unthinkingly.<br>
                 <input type="radio" name="q41" value="C"> C) Challenge authority figures.<br>
                 <input type="radio" name="q41" value="D"> D) Base beliefs on evidence only.
            </div>
            <div class="form-group">
                 <label>42. An "unwarranted assumption" is something taken for granted:</label>
                 <input type="radio" name="q42" value="A" required> A) With good reason based on experience.<br>
                 <input type="radio" name="q42" value="B"> B) Without good reason.<br>
                 <input type="radio" name="q42" value="C"> C) Only in scientific contexts.<br>
                 <input type="radio" name="q42" value="D"> D) After careful consideration.
            </div>
            <div class="form-group">
                 <label>43. Stereotyping involves assuming that:</label>
                 <input type="radio" name="q43" value="A" required> A) Individuals have unique characteristics.<br>
                 <input type="radio" name="q43" value="B"> B) All or most members of a group are alike ("stamped from one plate").<br>
                 <input type="radio" name="q43" value="C"> C) Group membership is irrelevant.<br>
                 <input type="radio" name="q43" value="D"> D) First impressions are usually wrong.
            </div>
            <div class="form-group">
                 <label>44. Relativistic thinking is the general view that:</label>
                 <input type="radio" name="q44" value="A" required> A) Truth is objective and absolute.<br>
                 <input type="radio" name="q44" value="B"> B) Truth is a matter of opinion (either individual or cultural).<br>
                 <input type="radio" name="q44" value="C"> C) Some opinions are better supported by evidence than others.<br>
                 <input type="radio" name="q44" value="D"> D) Critical thinking can lead to absolute certainty.
            </div>
            <div class="form-group">
                 <label>45. Subjectivism holds that truth is relative to:</label>
                 <input type="radio" name="q45" value="A" required> A) The culture or society.<br>
                 <input type="radio" name="q45" value="B"> B) Scientific consensus.<br>
                 <input type="radio" name="q45" value="C"> C) The individual person.<br>
                 <input type="radio" name="q45" value="D"> D) Objective facts.
            </div>
            <div class="form-group">
                 <label>46. Cultural relativism holds that truth is relative to:</label>
                 <input type="radio" name="q46" value="A" required> A) The individual person.<br>
                 <input type="radio" name="q46" value="B"> B) One's own personal feelings.<br>
                 <input type="radio" name="q46" value="C"> C) Objective reality.<br>
                 <input type="radio" name="q46" value="D"> D) Social or cultural opinion.
            </div>
            <div class="form-group">
                 <label>47. A major problem with moral relativism is that:</label>
                 <input type="radio" name="q47" value="A" required> A) It strongly supports universal tolerance in all cases.<br>
                 <input type="radio" name="q47" value="B"> B) Widespread disagreement about an issue does not necessarily prove there is no objective truth about it.<br>
                 <input type="radio" name="q47" value="C"> C) It eliminates all moral disagreements.<br>
                 <input type="radio" name="q47" value="D"> D) It is based on objective scientific facts.
            </div>
            <div class="form-group">
                 <label>48. "Wishful thinking" involves believing something primarily because:</label>
                 <input type="radio" name="q48" value="A" required> A) There is strong evidence for it.<br>
                 <input type="radio" name="q48" value="B"> B) It has been proven scientifically.<br>
                 <input type="radio" name="q48" value="C"> C) One wishes it were true.<br>
                 <input type="radio" name="q48" value="D"> D) An authority figure claims it is true.
            </div>
            <div class="form-group">
                 <label>49. Critical thinking skills learned in university, such as evaluating arguments and judging credibility, are valuable because they are:</label>
                 <input type="radio" name="q49" value="A" required> A) Applicable only to philosophy courses.<br>
                 <input type="radio" name="q49" value="B"> B) Transferable to other subjects and contexts in life.<br>
                 <input type="radio" name="q49" value="C"> C) Useful only for classroom performance.<br>
                 <input type="radio" name="q49" value="D"> D) A way to avoid making difficult decisions.
            </div>
            <div class="form-group">
                 <label>50. One of the key benefits of critical thinking for life outside the classroom is:</label>
                 <input type="radio" name="q50" value="A" required> A) Ensuring one always agrees with prevailing customs.<br>
                 <input type="radio" name="q50" value="B"> B) Helping promote democratic processes by enabling informed evaluation of policies and leaders.<br>
                 <input type="radio" name="q50" value="C"> C) Making personal decisions based purely on emotion.<br>
                 <input type="radio" name="q50" value="D"> D) Confirming one's existing biases and assumptions.
            </div>

            <button type="button" onclick="showReview()">Submit</button>
        </form>
        <div id="error-message" class="hidden">
            <p>Something went wrong. Please try again.</p>
        </div>
    </div>

    <div id="review-section" class="hidden">
        <h2>Review Your Answers</h2>
        <div id="review-content"></div>
        <button onclick="editForm()">Edit</button>
        <button onclick="downloadResponse()" id="download-response">Download My Response</button>
        <button onclick="confirmSubmission()">Confirm Submission</button>
    </div>

    <div id="submission-copy" class="hidden">
        <h2>Your Submitted Answers</h2>
        <div id="submission-content"></div>
        <button onclick="proceedToPassword()">Proceed</button>
    </div>

    <div id="password-section" class="hidden">
        <h1 id="success-message">Your response has been submitted</h1>
        <p>You can view your result (score) by entering the password.</p>
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
        <p id="password-error" class="hidden">Incorrect password. Please try again.</p>
    </div>

    <div id="results" class="hidden">
        <h1>Quiz Results</h1>
        <p id="student-info"></p>
        <div id="answers"></div>
        <p id="score"></p>
        <button id="download-pdf" onclick="downloadPDF()">Download Results PDF</button>
    </div>

            <script>
        let quizData = null;
        let formData = null;
        const { jsPDF } = window.jspdf;
        const TOTAL_QUESTIONS = 50; // Total number of questions

        // *** ADD/UPDATE THIS LINE - SET CHAPTER TO 4 ***
        // Define the chapter number for THIS specific quiz file (Chapter 4)
        const CURRENT_QUIZ_CHAPTER = 4;

        // *** ADD/UPDATE THIS LINE - DEFINE COURSE CODE ***
        const COURSE_CODE = 'PHIL1009'; // Course code updated to PHIL1009 (or change if needed)

        // Valid login credentials (Remains the same)
        const validCredentials = [
            { username: 'section19', password: '123' },
            { username: 'section20', password: '123' },
            { username: 'muzemuza', password: 'moh' },
            { username: 'section21', password: '123' }
            // Add more valid credentials as needed
        ];

        // Structure holding question texts and choices (UPDATED FOR CRITICAL THINKING Ch4)
        const allQuestionsData = {
             q1: { text: 'The main goal of teaching critical thinking is to teach students:', choices: { A: 'To passively absorb information for tests.', B: 'How to become independent, self-directed thinkers and learners.', C: 'Specific facts about various academic subjects.', D: 'To agree with the majority opinion.' } },
             q2: { text: 'Critical thinking, in a precise sense, involves cognitive skills and dispositions needed to:', choices: { A: 'Memorize and repeat information.', B: 'Accept claims based on authority without question.', C: 'Effectively identify, analyze, and evaluate arguments and truth claims.', D: 'Focus only on the emotional aspects of issues.' } },
             q3: { text: 'John Dewey defined critical thinking as an "active" process, meaning it involves:', choices: { A: 'Receiving ideas passively from others.', B: 'Thinking things through for oneself, raising questions, and finding information.', C: 'Jumping to conclusions quickly.', D: 'Relying solely on intuition.' } },
             q4: { text: 'According to Dewey, the "grounds" which support a belief refer to:', choices: { A: 'The emotional appeal of the belief.', B: 'The popularity of the belief.', C: 'The reasons one has for holding the belief.', D: 'The further conclusions that follow from the belief.' } },
             q5: { text: 'Edward Glaser\'s definition of critical thinking includes an attitude, knowledge of logical methods, and:', choices: { A: 'A high intelligence quotient.', B: 'Extensive factual knowledge.', C: 'Skill in applying logical methods.', D: 'The ability to persuade others.' } },
             q6: { text: 'Robert Ennis defined critical thinking as "reasonable, reflective thinking focused on":', choices: { A: 'Winning arguments.', B: 'Understanding historical context.', C: 'Achieving personal success.', D: 'Deciding what to believe or do.' } },
             q7: { text: 'Richard Paul\'s definition emphasizes improving thinking by skillfully taking charge of its inherent structures and:', choices: { A: 'Applying emotional intelligence.', B: 'Consulting with experts.', C: 'Imposing intellectual standards upon them.', D: 'Remembering past experiences.' } },
             q8: { text: 'Michael Scriven defined critical thinking as the "skilled and active interpretation and evaluation" of observations, communications, information, and:', choices: { A: 'Personal feelings.', B: 'Argumentation.', C: 'Historical trends.', D: 'Artistic expressions.' } },
             q9: { text: 'The term "criticocreative" thinking is used to highlight that effective evaluation often requires:', choices: { A: 'Sticking strictly to established procedures.', B: 'Ignoring alternative possibilities.', C: 'Imagination and creativity regarding alternatives and possibilities.', D: 'Focusing only on the negative aspects of an argument.' } },
             q10: { text: 'Which of the following is listed as a key intellectual standard for critical thinking?', choices: { A: 'Popularity', B: 'Emotional Intensity', C: 'Clarity', D: 'Subjectivity' } },
             q11: { text: 'The standard of "Clarity" requires that concepts and language be:', choices: { A: 'Highly complex and technical.', B: 'Free of obscurity and vagueness.', C: 'Emotionally charged.', D: 'Open to multiple interpretations.' } },
             q12: { text: 'Why is clarity considered a "gateway standard"?', choices: { A: 'It is the least important standard.', B: 'It only applies to written arguments.', C: 'If a statement is unclear, its accuracy or relevance cannot be determined.', D: 'Clear statements are always true.' } },
             q13: { text: 'The standard of "Precision" involves being:', choices: { A: 'Vague and general.', B: 'Subjective and opinionated.', C: 'Exact, accurate, and careful.', D: 'Brief and concise.' } },
             q14: { text: 'The standard of "Accuracy" relates to:', choices: { A: 'Using grammatically correct language.', B: 'Ensuring information is correct and true.', C: 'Expressing ideas eloquently.', D: 'Citing numerous sources.' } },
             q15: { text: 'The standard of "Relevance" means that ideas and information should:', choices: { A: 'Be connected and bear upon the issue at hand.', B: 'Come from a recognized authority.', C: 'Be completely new and original.', D: 'Be complex and difficult to understand.' } },
             q16: { text: '"Logical inconsistency" refers to:', choices: { A: 'Saying one thing and doing another.', B: 'Holding beliefs that cannot all be true simultaneously.', C: 'Disagreeing with an authority figure.', D: 'Changing one\'s mind based on new evidence.' } },
             q17: { text: '"Practical inconsistency" refers to:', choices: { A: 'Believing contradictory statements.', B: 'Drawing illogical conclusions.', C: 'Saying one thing and doing another (hypocrisy).', D: 'Failing to provide evidence for a claim.' } },
             q18: { text: 'The standard of "Logical Correctness" relates to:', choices: { A: 'The truthfulness of the premises.', B: 'Reasoning correctly and drawing well-founded conclusions.', C: 'Expressing ideas clearly.', D: 'Considering all possible viewpoints.' } },
             q19: { text: 'The standard of "Completeness" suggests a preference for thinking that is:', choices: { A: 'Shallow and superficial.', B: 'Quick and intuitive.', C: 'Deep and thorough.', D: 'Focused on a single perspective.' } },
             q20: { text: 'The standard of "Fairness" requires thinking to be:', choices: { A: 'Biased towards one\'s own viewpoint.', B: 'Open-minded, impartial, and free of distorting biases.', C: 'Based on popular opinion.', D: 'Consistent with tradition.' } },
             q21: { text: 'The "Structural Principle" of good argument requires that an argument:', choices: { A: 'Uses emotionally charged language.', B: 'Meets the requirements of being well-formed (e.g., avoids contradictions, assumes conclusion).', C: 'Agrees with the arguer\'s personal beliefs.', D: 'Has at least five premises.' } },
             q22: { text: 'The "Relevance Principle" of good argument requires that premises:', choices: { A: 'Are acceptable to the audience.', B: 'Provide some evidence for the truth of the conclusion.', C: 'Are absolutely true.', D: 'Are sufficient to prove the conclusion.' } },
             q23: { text: 'The "Acceptability Principle" suggests premises should be acceptable to:', choices: { A: 'The arguer only.', B: 'Anyone, regardless of evidence.', C: 'A mature, rational person based on available evidence.', D: 'Those who already agree with the conclusion.' } },
             q24: { text: 'The "Sufficiency Principle" requires that the premises provided are:', choices: { A: 'Relevant, acceptable, and adequate in number and weight to justify the conclusion.', B: 'Absolutely true.', C: 'Emotionally compelling.', D: 'Logically valid, regardless of truth.' } },
             q25: { text: 'The "Rebuttal Principle" requires that a good argument should also:', choices: { A: 'Ignore potential criticisms.', B: 'Only present evidence supporting its own conclusion.', C: 'Anticipate and effectively address serious criticisms against it or the position it supports.', D: 'Attack the person making counterarguments.' } },
             q26: { text: 'The "Fallibility Principle" of critical thinking requires acknowledging that:', choices: { A: 'Others are usually wrong.', B: 'One\'s own initial view may be wrong or not the most defensible.', C: 'Truth is impossible to find.', D: 'Arguments should not be changed once stated.' } },
             q27: { text: 'The "Truth Seeking Principle" commits participants to:', choices: { A: 'Defending their initial position at all costs.', B: 'Earnestly searching for the truth or most defensible position.', C: 'Finding flaws in opponents\' arguments only.', D: 'Reaching a quick consensus.' } },
             q28: { text: 'The "Clarity Principle" in critical discussion requires that formulations be:', choices: { A: 'Vague enough to allow flexibility.', B: 'Expressed using technical jargon only.', C: 'Free of linguistic confusion and clearly separated from other issues.', D: 'Brief, even if incomplete.' } },
             q29: { text: 'The "Burden of Proof Principle" generally rests the obligation to provide reasons on:', choices: { A: 'The participant who challenges a claim.', B: 'The participant who sets forth the position or makes the claim.', C: 'An external authority.', D: 'No one; claims don\'t require proof.' } },
             q30: { text: 'The "Principle of Charity" requires that when reformulating an opponent\'s argument, one should:', choices: { A: 'Express it in its weakest possible version.', B: 'Ignore the original intention of the arguer.', C: 'Carefully express it in its strongest possible version consistent with the arguer\'s intent.', D: 'Focus only on the flaws.' } },
             q31: { text: 'The "Suspension of Judgment Principle" suggests that if no position is well-defended or multiple positions have equal support, one should:', choices: { A: 'Choose the position held by the majority.', B: 'Choose the position one initially favored.', C: 'Suspend judgment about the issue (unless practical needs demand a decision).', D: 'Assume the simplest position is true.' } },
             q32: { text: 'The "Resolution Principle" states an issue should be considered resolved when:', choices: { A: 'Everyone agrees, regardless of the arguments.', B: 'An argument for one position meets all the principles of a good argument (sound, relevant, sufficient, rebuts criticisms) more successfully than alternatives.', C: 'A specific amount of time has passed.', D: 'An authority figure declares it resolved.' } },
             q33: { text: 'A key characteristic of critical thinkers is that they:', choices: { A: 'Pretend to know more than they do.', B: 'Base judgments on evidence rather than personal preference.', C: 'Are impatient with complexity.', D: 'Ignore other people\'s ideas.' } },
             q34: { text: 'A key characteristic of uncritical thinkers is that they:', choices: { A: 'Strive for understanding and keep curiosity alive.', B: 'Base judgments on first impressions and gut reactions.', C: 'Remain patient with complexity.', D: 'Are willing to revise judgments based on new evidence.' } },
             q35: { text: 'Critical thinkers tend to view problems and controversial issues as:', choices: { A: 'Nuisances or threats to their ego.', B: 'Exciting challenges.', C: 'Reasons to avoid discussion.', D: 'Proof that truth is unattainable.' } },
             q36: { text: 'Compared to uncritical thinkers, critical thinkers are more likely to be:', choices: { A: 'Closed-minded and resistant to criticism.', B: 'Aware of their own biases and preconceptions.', C: 'Indifferent to truth.', D: 'Preoccupied with their own opinions.' } },
             q37: { text: 'Egocentrism, as a barrier to critical thinking, is the tendency to:', choices: { A: 'See reality as centered on oneself.', B: 'Follow group standards unthinkingly.', C: 'Take assumptions for granted without good reason.', D: 'Believe something simply because one wishes it were true.' } },
             q38: { text: 'Self-interested thinking is a form of egocentrism where reasoning is biased by:', choices: { A: 'What benefits oneself.', B: 'Concern for the group\'s welfare.', C: 'Objective evidence.', D: 'Widely accepted facts.' } },
             q39: { text: 'Sociocentrism is a barrier involving:', choices: { A: 'Excessive focus on the self.', B: 'Group-centered thinking.', C: 'Believing what one wants to believe.', D: 'Making assumptions without evidence.' } },
             q40: { text: 'Group bias, a form of sociocentrism, is the tendency to see one\'s own group (nation, culture, etc.) as:', choices: { A: 'Inferior to others.', B: 'Objectively flawed.', C: 'Inherently better than others.', D: 'Exactly the same as all other groups.' } },
             q41: { text: 'Conformism refers to the tendency to:', choices: { A: 'Think independently.', B: 'Follow the crowd or group standards, often unthinkingly.', C: 'Challenge authority figures.', D: 'Base beliefs on evidence only.' } },
             q42: { text: 'An "unwarranted assumption" is something taken for granted:', choices: { A: 'With good reason based on experience.', B: 'Without good reason.', C: 'Only in scientific contexts.', D: 'After careful consideration.' } },
             q43: { text: 'Stereotyping involves assuming that:', choices: { A: 'Individuals have unique characteristics.', B: 'All or most members of a group are alike ("stamped from one plate").', C: 'Group membership is irrelevant.', D: 'First impressions are usually wrong.' } },
             q44: { text: 'Relativistic thinking is the general view that:', choices: { A: 'Truth is objective and absolute.', B: 'Truth is a matter of opinion (either individual or cultural).', C: 'Some opinions are better supported by evidence than others.', D: 'Critical thinking can lead to absolute certainty.' } },
             q45: { text: 'Subjectivism holds that truth is relative to:', choices: { A: 'The culture or society.', B: 'Scientific consensus.', C: 'The individual person.', D: 'Objective facts.' } },
             q46: { text: 'Cultural relativism holds that truth is relative to:', choices: { A: 'The individual person.', B: 'One\'s own personal feelings.', C: 'Objective reality.', D: 'Social or cultural opinion.' } },
             q47: { text: 'A major problem with moral relativism is that:', choices: { A: 'It strongly supports universal tolerance in all cases.', B: 'Widespread disagreement about an issue does not necessarily prove there is no objective truth about it.', C: 'It eliminates all moral disagreements.', D: 'It is based on objective scientific facts.' } },
             q48: { text: '"Wishful thinking" involves believing something primarily because:', choices: { A: 'There is strong evidence for it.', B: 'It has been proven scientifically.', C: 'One wishes it were true.', D: 'An authority figure claims it is true.' } },
             q49: { text: 'Critical thinking skills learned in university, such as evaluating arguments and judging credibility, are valuable because they are:', choices: { A: 'Applicable only to philosophy courses.', B: 'Transferable to other subjects and contexts in life.', C: 'Useful only for classroom performance.', D: 'A way to avoid making difficult decisions.' } },
             q50: { text: 'One of the key benefits of critical thinking for life outside the classroom is:', choices: { A: 'Ensuring one always agrees with prevailing customs.', B: 'Helping promote democratic processes by enabling informed evaluation of policies and leaders.', C: 'Making personal decisions based purely on emotion.', D: 'Confirming one\'s existing biases and assumptions.' } }
        };

        // Correct answers mapped to letters (UPDATED FOR CRITICAL THINKING Ch4)
        const correctAnswersMap = {
             q1: 'B', q2: 'C', q3: 'B', q4: 'C', q5: 'C',
             q6: 'D', q7: 'C', q8: 'B', q9: 'C', q10: 'C',
             q11: 'B', q12: 'C', q13: 'C', q14: 'B', q15: 'A',
             q16: 'B', q17: 'C', q18: 'B', q19: 'C', q20: 'B',
             q21: 'B', q22: 'B', q23: 'C', q24: 'A', q25: 'C',
             q26: 'B', q27: 'B', q28: 'C', q29: 'B', q30: 'C',
             q31: 'C', q32: 'B', q33: 'B', q34: 'B', q35: 'B',
             q36: 'B', q37: 'A', q38: 'A', q39: 'B', q40: 'C',
             q41: 'B', q42: 'B', q43: 'B', q44: 'B', q45: 'C',
             q46: 'D', q47: 'B', q48: 'C', q49: 'B', q50: 'B'
        };

        function checkLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorMessage = document.getElementById('login-error');
            const loginSection = document.getElementById('login-section');
            const quizForm = document.getElementById('quiz-form');

            const isValid = validCredentials.some(cred =>
                cred.username === username && cred.password === password
            );

            if (isValid) {
                errorMessage.classList.add('hidden');
                loginSection.classList.add('hidden');
                quizForm.classList.remove('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function showReview() {
            const form = document.getElementById('mcie-quiz');
            formData = new FormData(form);
            const data = Object.fromEntries(formData);

             // Check if all questions are answered
             let allAnswered = true;
             for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 if (!data[`q${i}`]) {
                     allAnswered = false;
                     break;
                 }
             }

             if (!data.name || !data.id_number || !data.section || !data.email || !data.phone || !allAnswered) {
                 alert('Please fill in all personal information and answer all questions before submitting.');
                 return; // Stop the function if validation fails
             }

            // Store quiz data temporarily
            quizData = {
                name: data.name,
                id_number: data.id_number,
                section: data.section,
                email: data.email,
                phone: data.phone,
                answers: {},
                questions: allQuestionsData, // Use the predefined structure
                chapter: CURRENT_QUIZ_CHAPTER, // Added chapter to quizData
                courseCode: COURSE_CODE // Added course code to quizData
            };

            // Construct the formatted chapter string for display
             const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;


            // Populate answers dynamically
            let reviewHTML = `
                <p><strong>Name:</strong> ${data.name}</p>
                <p><strong>ID Number:</strong> ${data.id_number}</p>
                <p><strong>Section:</strong> ${data.section}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Phone Number:</strong> ${data.phone}</p>
                 <p><strong>Chapter:</strong> ${quizData.chapter}</p>
                 <p><strong>Course & Chapter:</strong> ${formattedCourseChapter}</p> <!-- Added formatted chapter to review display -->
                <hr>
                <h3>Your Answers:</h3>
            `;

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const qKey = `q${i}`;
                const userAnswer = data[qKey];
                quizData.answers[qKey] = userAnswer; // Store answer
                const questionInfo = allQuestionsData[qKey];
                const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                reviewHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
            }

            // Display review content
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = reviewHTML;

            // Show review section
            document.getElementById('quiz-form').classList.add('hidden');
            document.getElementById('review-section').classList.remove('hidden');
        }

        function editForm() {
            document.getElementById('review-section').classList.add('hidden');
            document.getElementById('quiz-form').classList.remove('hidden');
        }

        function downloadResponse() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;


            doc.setFontSize(16);
            // Updated Title for PDF
            doc.text(`Critical Thinking Quiz Response`, pageWidth / 2, y, { align: 'center' }); // Reflects new quiz topic
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 7;
            doc.text(`Chapter: ${quizData.chapter}`, margin, y); y += 7;
            doc.text(`Course & Chapter: ${formattedCourseChapter}`, margin, y); y += 10; // Added formatted chapter to PDF


            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const answerText = question.choices[userAnswer] || 'Not Answered';
                 const questionText = question.text;

                 // Estimate space needed for the question + answer
                 const questionLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const answerLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${answerText}`, effectiveWidth);
                 const spaceNeeded = (questionLines.length * 5) + 2 + (answerLines.length * 5) + 5; // Estimate lines * line height + spacing

                 if (y + spaceNeeded > pageHeight - margin) { // Check if content fits
                    doc.addPage();
                    y = margin;
                 }

                doc.setFont('helvetica', 'bold');
                doc.text(questionLines, margin, y);
                y += (questionLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');

                if (y > pageHeight - margin) { doc.addPage(); y = margin; }

                doc.text(answerLines, margin, y);
                y += (answerLines.length * 5) + 5;

            }

            // Updated filename using formatted chapter string
            doc.save(`${formattedCourseChapter.replace(/ /g, '_')}_response_${quizData.id_number}.pdf`);
        }

        // --- MODIFIED: confirmSubmission Function ---
        async function confirmSubmission() {
            if (confirm('Are you sure you want to submit your answers?')) {
                if (!quizData || !formData) {
                     console.error("Quiz data or form data is missing.");
                     alert("Error: Cannot submit. Please try filling the form again.");
                     editForm(); // Go back to edit
                     return;
                }

                const data = Object.fromEntries(formData); // Use the stored formData

                // Calculate score
                let score = 0;
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    const qKey = `q${i}`;
                    if (data[qKey] === correctAnswersMap[qKey]) {
                        score++;
                    }
                }

                // Update quizData with score (Optional but good practice)
                quizData.score = score;

                // *** CONSTRUCT THE FORMATTED CHAPTER STRING ***
                const formattedCourseChapter = `${COURSE_CODE} Chapter ${CURRENT_QUIZ_CHAPTER}`;


                // Prepare data for YOUR backend
                const submissionData = {
                    name: data.name,
                    id_number: data.id_number,
                    section: data.section,
                    email: data.email,
                    phone: data.phone,
                    score: score,
                    totalQuestions: TOTAL_QUESTIONS,
                    quizChapter: CURRENT_QUIZ_CHAPTER, // Keep the integer (4)
                    // *** ADDED SPECIFIC QUIZ TITLE ***
                    quizTitle: `Basic Concepts of Critical Thinking Quiz - Chapter ${CURRENT_QUIZ_CHAPTER}`,
                    // submittedAt: new Date().toISOString(), // Add if needed by backend
                    // answers: quizData.answers // Add if needed by backend

                    // *** ADD THE NEW FIELD WITH THE FORMATTED STRING ***
                    course_chapter_formatted: formattedCourseChapter,
                };

                console.log("Submitting quiz data:", submissionData);

                try {
                    // Show "Submitting..." message or spinner here if desired

                    const response = await fetch('/submit-quiz', { // Point to your backend endpoint
                        method: 'POST',
                        body: JSON.stringify(submissionData), // Send the data as JSON
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json' // Important Header!
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('Submission successful:', result);
                        alert("Quiz submitted successfully!"); // Provide feedback to user

                        // Show submission copy
                        const submissionContent = document.getElementById('submission-content');
                         let submissionHTML = `
                            <p><strong>Name:</strong> ${quizData.name}</p>
                            <p><strong>ID Number:</strong> ${quizData.id_number}</p>
                            <p><strong>Section:</strong> ${quizData.section}</p>
                            <p><strong>Email:</strong> ${quizData.email}</p>
                            <p><strong>Phone Number:</strong> ${quizData.phone}</p>
                            <p><strong>Chapter:</strong> ${quizData.chapter}</p>
                             <p><strong>Course & Chapter:</strong> ${formattedCourseChapter}</p> <!-- Added formatted chapter to submission copy -->
                            <hr>
                            <h3>Submitted Answers:</h3>
                        `;
                         for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                             const qKey = `q${i}`;
                             const questionInfo = quizData.questions[qKey];
                             const userAnswer = quizData.answers[qKey];
                             const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                             submissionHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
                         }
                        submissionContent.innerHTML = submissionHTML;

                        document.getElementById('review-section').classList.add('hidden');
                        document.getElementById('submission-copy').classList.remove('hidden');


                    } else {
                        let errorMsg = `Submission failed with status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.error || errorData.message || errorMsg;
                        } catch(e) { /* Ignore if response isn't JSON */ }

                        console.error('Backend submission error:', errorMsg);
                        document.getElementById('error-message').innerHTML = `<p>Submission failed: ${errorMsg}. Please try again.</p>`;
                        document.getElementById('error-message').classList.remove('hidden');
                        document.getElementById('review-section').classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Network/Fetch error:', error);
                    document.getElementById('error-message').innerHTML = `<p>An network error occurred during submission. Please check your connection and try again.</p>`;
                    document.getElementById('error-message').classList.remove('hidden');
                    document.getElementById('review-section').classList.add('hidden');
                }
            }
        }


        function proceedToPassword() {
            document.getElementById('submission-copy').classList.add('hidden');
            document.getElementById('password-section').classList.remove('hidden');
        }

        function checkPassword() {
            const passwordInput = document.getElementById('password').value;
            const correctPassword = 'password'; // Keep the simple password
            const errorMessage = document.getElementById('password-error');
            const passwordSection = document.getElementById('password-section');
            const results = document.getElementById('results');

            if (passwordInput === correctPassword) {
                errorMessage.classList.add('hidden');
                passwordSection.classList.add('hidden');
                results.classList.remove('hidden');
                displayResults();
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function displayResults() {
            if (!quizData) {
                document.getElementById('results').innerHTML = '<p>Error: No quiz data found. Please complete the quiz first.</p>';
                return;
            }

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`; // Changed format slightly
             }

            const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;

            // Added formatted chapter to results display
            document.getElementById('student-info').innerHTML = `<strong>Name:</strong> ${quizData.name}<br><strong>ID:</strong> ${quizData.id_number}<br><strong>Section:</strong> ${quizData.section}<br><strong>Email:</strong> ${quizData.email}<br><strong>Phone:</strong> ${quizData.phone}<br><strong>Chapter:</strong> ${quizData.chapter}<br><strong>Course & Chapter:</strong> ${formattedCourseChapter}`;


            const answersDiv = document.getElementById('answers');
            let answersHTML = '<h3>Detailed Results:</h3>';

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];

                 answersHTML += `
                    <div class="question-result">
                        <p><strong>Question ${i}:</strong> ${question.text}</p>
                        <div class="choices" style="font-size:0.9em; margin-left: 15px;">
                            <p>A) ${question.choices.A}</p>
                            <p>B) ${question.choices.B}</p>
                            <p>C) ${question.choices.C}</p>
                            <p>D) ${question.choices.D}</p>
                        </div>
                        <p>Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '<span style="color:green; font-weight:bold;">(Correct)</span>' : '<span style="color:red; font-weight:bold;">(Incorrect)</span>'}</p>
                        ${!isCorrect ? `<p style="color:blue;">Correct answer: ${displayCorrectAnswers[qKey]}</p>` : ''}
                    </div>
                `;
            }
            answersDiv.innerHTML = answersHTML;


            document.getElementById('score').textContent = `Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`;
        }

        // --- Completed downloadPDF Function ---
        function downloadPDF() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;

            doc.setFontSize(16);
            // Updated Title for PDF
            doc.text(`Critical Thinking Quiz Results`, pageWidth / 2, y, { align: 'center' }); // Reflects new topic
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 7;
             // Added formatted chapter to PDF
            doc.text(`Course & Chapter: ${formattedCourseChapter}`, margin, y); y += 10;


            doc.setFont('helvetica', 'bold');
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });
            y += 10;
            doc.setFont('helvetica', 'normal');


            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];
                 const questionText = question.text;
                 const correctAnswerFull = displayCorrectAnswers[qKey];

                 // Estimate space needed
                 const qLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const choicesLinesHeight = 4 * 5; // Estimate height for 4 choices
                 const yourAnsLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, effectiveWidth);
                 const correctAnsLinesHeight = isCorrect ? 0 : doc.splitTextToSize(`Correct answer: ${correctAnswerFull}`, effectiveWidth).length * 5; // Height needed for correct answer if wrong
                 const spaceNeeded = (qLines.length * 5) + 2 + choicesLinesHeight + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLinesHeight + 5;


                 if (y + spaceNeeded > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                }

                doc.setFont('helvetica', 'bold');
                doc.text(qLines, margin, y);
                y += (qLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');

                 const remainingSpaceAfterQuestion = pageHeight - margin - y;
                 const answersSectionSpace = choicesLinesHeight + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLinesHeight + 5;

                 // Prevent choices/answers from being split awkwardly if possible
                 if (answersSectionSpace > remainingSpaceAfterQuestion) {
                     doc.addPage();
                     y = margin;
                 }


                doc.setFontSize(10);
                doc.text(`  A) ${question.choices.A}`, margin + 5, y); y += 5;
                doc.text(`  B) ${question.choices.B}`, margin + 5, y); y += 5;
                doc.text(`  C) ${question.choices.C}`, margin + 5, y); y += 5;
                doc.text(`  D) ${question.choices.D}`, margin + 5, y); y += 7;
                doc.setFontSize(12);


                doc.text(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, margin, y); y += 7;

                if (!isCorrect) {
                    doc.setTextColor(0, 0, 255);
                    doc.text(`Correct answer: ${correctAnswerFull}`, margin, y); y += 7;
                    doc.setTextColor(0, 0, 0);
                }
                y += 5; // Space before next question

            }

            // Add score again at the end if needed
            if (y > pageHeight - margin) { doc.addPage(); y = margin; }
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });

            // Updated filename to include formatted chapter
            doc.save(`${formattedCourseChapter.replace(/ /g, '_')}_results_${quizData.id_number}.pdf`);
        }
    </script>
</body>
</html>
